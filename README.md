# SPAdes
Culex species identification and blood meal analysis with de novo assembly of illumina reads from amplicon resequencing (COI, Ace2, cqm1)

# A place to keep track of Culex blood meal bioinformatics steps

## Logging onto CHPC with Terminal on a mac
1. Open Terminal
2. ssh u6036559@notchpeak.chpc.utah.edu        #replace with your username
3. salloc --time=72:00:00 --ntasks 1 --mem=100G --account=saarman-np --partition=saarman-shared-np

## Outline of steps:
1. fastqc to trim/clean/quality control
2. SPAdes for de novo assembly, https://biomedicalhub.github.io/genomics/04-part4-denovo-assembly.html
3. Filter contigs for min length and min coverage
4. Clustering/Blastn to identify ace2/cqm1 haplotypes and COi match

## Manuals for fastqc, SPades 
 - fastqc https://www.bioinformatics.babraham.ac.uk/projects/fastqc/
 - SPAdes https://ablab.github.io/spades/ 

# Task 1: FastQC

## Make output directory
```
# CD to working directory
cd /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718

# make dir for fastqc
mkdir fastqc

#change permissions
chmod -R g+w fastqc
```

## Run command
```
# load module 
module load fastqc

# run fastqc for all .fastq.gz files in directory
fastqc *.fastq.gz -o ./fastqc

#change permissions
chmod -R g+w fastqc
```

# Task 2: SPAdes

## Example command
```
module load SPAdes
spades.py -1 left.fastq.gz -2 right.fastq.gz -o output_folder
```

## Make an directory and change permissions
```
cd /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718
mkdir denovo_assembly
chmod -R g+w /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718
```

## Run SPAdes de novo assembly with a loop

```
# change directory
cd /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718

# load module
module load SPAdes

# run loop with ls to check that inputs exist, run spades for each
bash
for SAMPLE in `echo B002-UT-M70330-240718_S97	 B004-UT-M70330-240718_S98	 B005-UT-M70330-240718_S99	 B014-UT-M70330-240718_S100	 B018-UT-M70330-240718_S101	 B020-UT-M70330-240718_S102	 B021-UT-M70330-240718_S103	 B024-UT-M70330-240718_S104	 B027-UT-M70330-240718_S105	 B040-UT-M70330-240718_S107	 B064-UT-M70330-240718_S108	 B080-UT-M70330-240718_S109	 B081-UT-M70330-240718_S110	 B082-UT-M70330-240718_S111	 B098-UT-M70330-240718_S112	 B109-UT-M70330-240718_S113	 B117-UT-M70330-240718_S114	 B118-UT-M70330-240718_S115	 B119-UT-M70330-240718_S116	 B120-UT-M70330-240718_S117	 B126-UT-M70330-240718_S118	 B133-UT-M70330-240718_S184	 B134-UT-M70330-240718_S185	 B135-UT-M70330-240718_S186	 B136-UT-M70330-240718_S187	 B137-UT-M70330-240718_S188	 B138-UT-M70330-240718_S189	 B139-UT-M70330-240718_S190	 B140-UT-M70330-240718_S191	 B141-UT-M70330-240718_S192	 B145-UT-M70330-240718_S88	 B146-UT-M70330-240718_S89	 B147-UT-M70330-240718_S90	 B148-UT-M70330-240718_S91	 B149-UT-M70330-240718_S92	 B150-UT-M70330-240718_S93	 B169-UT-M70330-240718_S119	 B180-UT-M70330-240718_S120	 B181-UT-M70330-240718_S121	 B183-UT-M70330-240718_S122	 B184-UT-M70330-240718_S123	 B188-UT-M70330-240718_S124	 B189-UT-M70330-240718_S125	 B192-UT-M70330-240718_S126	 B193-UT-M70330-240718_S127	 B194-UT-M70330-240718_S128	 B204-UT-M70330-240718_S129	 B207-UT-M70330-240718_S130	 B216-UT-M70330-240718_S131	 B227-UT-M70330-240718_S132	 B228-UT-M70330-240718_S133	 B229-UT-M70330-240718_S134	 B235-UT-M70330-240718_S135	 B258-UT-M70330-240718_S136	 B259-UT-M70330-240718_S137	 B261-UT-M70330-240718_S138	 B262-UT-M70330-240718_S139	 B263-UT-M70330-240718_S140	 B264-UT-M70330-240718_S141	 B265-UT-M70330-240718_S142	 B277-UT-M70330-240718_S143	 B278-UT-M70330-240718_S144	 B280-UT-M70330-240718_S145	 B281-UT-M70330-240718_S146	 B282-UT-M70330-240718_S147	 B283-UT-M70330-240718_S148	 B284-UT-M70330-240718_S149	 B286-UT-M70330-240718_S150	 B289-UT-M70330-240718_S151	 B290-UT-M70330-240718_S152	 B291-UT-M70330-240718_S153	 B292-UT-M70330-240718_S154	 B297-UT-M70330-240718_S155	 B299-UT-M70330-240718_S156	 B301-UT-M70330-240718_S157	 B302-UT-M70330-240718_S158	 B303-UT-M70330-240718_S159	 B305-UT-M70330-240718_S160	 B306-UT-M70330-240718_S161	 B307-UT-M70330-240718_S162	 B308-UT-M70330-240718_S163	 B342-UT-M70330-240718_S164	 B343-UT-M70330-240718_S165	 B359-UT-M70330-240718_S166	 B375-UT-M70330-240718_S167	 B383-UT-M70330-240718_S168	 B390-UT-M70330-240718_S169	 B391-UT-M70330-240718_S170	 B392-UT-M70330-240718_S171	 B393-UT-M70330-240718_S172	 B394-UT-M70330-240718_S173	 B395-UT-M70330-240718_S174	 B424-UT-M70330-240718_S175	 B425-UT-M70330-240718_S176	 B427-UT-M70330-240718_S177	 B431-UT-M70330-240718_S178	 B443-UT-M70330-240718_S179	 B444-UT-M70330-240718_S180	 B445-UT-M70330-240718_S181	 B446-UT-M70330-240718_S182	 B447-UT-M70330-240718_S183	 B523-UT-M70330-240718_S1	 B524-UT-M70330-240718_S2	 B525-UT-M70330-240718_S3	 B526-UT-M70330-240718_S4	 B527-UT-M70330-240718_S5	 B528-UT-M70330-240718_S6	 B529-UT-M70330-240718_S7	 B530-UT-M70330-240718_S8	 B531-UT-M70330-240718_S9	 B532-UT-M70330-240718_S10	 B533-UT-M70330-240718_S11	 B534-UT-M70330-240718_S12	 B536-UT-M70330-240718_S13	 B537-UT-M70330-240718_S14	 B538-UT-M70330-240718_S15	 B539-UT-M70330-240718_S16	 B540-UT-M70330-240718_S17	 B541-UT-M70330-240718_S18	 B542-UT-M70330-240718_S19	 B543-UT-M70330-240718_S20	 B544-UT-M70330-240718_S21	 B545-UT-M70330-240718_S22	 B550-UT-M70330-240718_S23	 B551-UT-M70330-240718_S24	 B552-UT-M70330-240718_S25	 B553-UT-M70330-240718_S26	 B557-UT-M70330-240718_S27	 B591-UT-M70330-240718_S28	 B592-UT-M70330-240718_S29	 B593-UT-M70330-240718_S30	 B594-UT-M70330-240718_S31	 B597-UT-M70330-240718_S32	 B602-UT-M70330-240718_S33	 B633-UT-M70330-240718_S34	 B634-UT-M70330-240718_S35	 B635-UT-M70330-240718_S36	 B637-UT-M70330-240718_S37	 B668-UT-M70330-240718_S38	 B669-UT-M70330-240718_S39	 B670-UT-M70330-240718_S40	 B671-UT-M70330-240718_S41	 B672-UT-M70330-240718_S42	 B673-UT-M70330-240718_S43	 B674-UT-M70330-240718_S44	 B675-UT-M70330-240718_S45	 B677-UT-M70330-240718_S46	 B678-UT-M70330-240718_S47	 B679-UT-M70330-240718_S48	 B680-UT-M70330-240718_S49	 B681-UT-M70330-240718_S50	 B682-UT-M70330-240718_S51	 B683-UT-M70330-240718_S52	 B684-UT-M70330-240718_S53	 B685-UT-M70330-240718_S54	 B686-UT-M70330-240718_S55	 B687-UT-M70330-240718_S56	 B688-UT-M70330-240718_S57	 B750-UT-M70330-240718_S58	 B751-UT-M70330-240718_S59	 B752-UT-M70330-240718_S60	 B753-UT-M70330-240718_S61	 B754-UT-M70330-240718_S62	 B756-UT-M70330-240718_S63	 B767-UT-M70330-240718_S64	 B768-UT-M70330-240718_S65	 B769-UT-M70330-240718_S66	 B805-UT-M70330-240718_S67	 B806-UT-M70330-240718_S68	 B807-UT-M70330-240718_S69	 B831-UT-M70330-240718_S70	 B845-UT-M70330-240718_S71	 B846-UT-M70330-240718_S72	 B847-UT-M70330-240718_S73	 B855-UT-M70330-240718_S74	 B856-UT-M70330-240718_S75	 B857-UT-M70330-240718_S76	 B858-UT-M70330-240718_S77	 B861-UT-M70330-240718_S78	 B864-UT-M70330-240718_S79	 B865-UT-M70330-240718_S80	 B866-UT-M70330-240718_S81	 B867-UT-M70330-240718_S82	 B868-UT-M70330-240718_S83	 B869-UT-M70330-240718_S84	 B870-UT-M70330-240718_S85	 B871-UT-M70330-240718_S86	 B872-UT-M70330-240718_S87	`; do
  echo $SAMPLE
  ls -l ${SAMPLE}_L001_R1_001.fastq.gz
  ls -l ${SAMPLE}_L001_R2_001.fastq.gz
  spades.py -1 ${SAMPLE}_L001_R1_001.fastq.gz -2	${SAMPLE}_L001_R2_001.fastq.gz -o ./denovo_assembly/${SAMPLE} --isolate
done

#Remember to change permissions:
chmod -R g+w /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718
```

# Step 3: Filter and sort contigs output per sample, add sample to fasta header

## Example with filters (length, coverage), sorted by coverage
Filters, sorts, and adds name of sample to header of each contig
```
cd /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M07101-240702/denovo_assembly
bash
LENGTH=450 #change this to set min length
COVERAGE=20 #change this to set min coverage
MAXLEN=700 #change this to set max length
for SAMPLE in `ls -l | grep -v "total" |  grep -v "fasta" | awk '{print $NF}'`; do
  echo $SAMPLE
  perl -0076 -ne 'chomp;($h,@S)=split/\n/;$s=join("",@S);print"$h\t$s\n"unless(!$h)' ./${SAMPLE}/contigs.fasta  | sed 's/_/ /g' | awk -F " " -v a="$LENGTH" -v b="$COVERAGE" -v c="$MAXLEN" '$4>=a && $6>=b && $4<=c' |  sed 's/ /_/g'  | sort -r -t_ -nk6 | sed 's/\t/\n/g' | sed "s/NODE/\>${SAMPLE}/g" > ./${SAMPLE}/contigs.fasta
 cp ./${SAMPLE}/sorted_contigs.fasta ./${SAMPLE}_sorted_contigs.fasta
done

#update permissions
chmod -R g+w /uufs/chpc.utah.edu/common/home/saarman-group1/uphlfiles/UT-M70330-240718

#list all sorted matches
ls -l *sorted_contigs.fasta

#concatenate all sorted matches
cat *sorted_contigs.fasta    
```
# Step 4: 

